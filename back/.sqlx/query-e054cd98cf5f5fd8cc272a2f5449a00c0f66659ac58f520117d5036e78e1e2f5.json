{
  "db_name": "PostgreSQL",
  "query": "\n        select\n            policy.id,\n            type as \"policy_type: PolicyType\",\n            person.first_name || ' ' || person.last_name as \"holder_name!\",\n            series,\n            number,\n            start_date,\n            end_date,\n            policy.status as \"status: PolicyStatus\",\n            car.make || ' ' || car.model as car_model,\n            car.plate as \"car_plate?\",\n            (\n                select string_agg(a.full_name, ', ' order by a.full_name)\n                from agent a\n                join agent_policy ap on a.id = ap.agent_id\n                where ap.policy_id = policy.id\n            ) as agent_names\n        from policy\n        join person on policy.holder_id = person.id\n        left join green_card_policy on policy.id = green_card_policy.id\n        left join osago_policy on policy.id = osago_policy.id\n        left join car on car.id = coalesce(green_card_policy.car_id, osago_policy.car_id)\n        where\n            (lower(series || number) like $1\n            or lower(person.first_name || ' ' || person.last_name) like $1\n            or lower(coalesce(car.make || ' ' || car.model, '')) like $1\n            or lower(coalesce(car.plate, '')) like $1)\n            and (not $2 or policy.status = 'active')\n        order by start_date desc\n        limit 30\n        ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "id",
        "type_info": "Int4"
      },
      {
        "ordinal": 1,
        "name": "policy_type: PolicyType",
        "type_info": {
          "Custom": {
            "name": "policy_type",
            "kind": {
              "Enum": [
                "green_card",
                "medassistance",
                "osago"
              ]
            }
          }
        }
      },
      {
        "ordinal": 2,
        "name": "holder_name!",
        "type_info": "Text"
      },
      {
        "ordinal": 3,
        "name": "series",
        "type_info": "Varchar"
      },
      {
        "ordinal": 4,
        "name": "number",
        "type_info": "Varchar"
      },
      {
        "ordinal": 5,
        "name": "start_date",
        "type_info": "Date"
      },
      {
        "ordinal": 6,
        "name": "end_date",
        "type_info": "Date"
      },
      {
        "ordinal": 7,
        "name": "status: PolicyStatus",
        "type_info": {
          "Custom": {
            "name": "policy_status",
            "kind": {
              "Enum": [
                "active",
                "prolonged",
                "rejected",
                "stopped",
                "postponed",
                "cancelled",
                "project",
                "replaced",
                "expired"
              ]
            }
          }
        }
      },
      {
        "ordinal": 8,
        "name": "car_model",
        "type_info": "Text"
      },
      {
        "ordinal": 9,
        "name": "car_plate?",
        "type_info": "Varchar"
      },
      {
        "ordinal": 10,
        "name": "agent_names",
        "type_info": "Text"
      }
    ],
    "parameters": {
      "Left": [
        "Text",
        "Bool"
      ]
    },
    "nullable": [
      false,
      false,
      null,
      false,
      false,
      false,
      true,
      false,
      null,
      false,
      null
    ]
  },
  "hash": "e054cd98cf5f5fd8cc272a2f5449a00c0f66659ac58f520117d5036e78e1e2f5"
}
