{
  "db_name": "PostgreSQL",
  "query": "\n        select\n            policy.id,\n            type as \"policy_type: PolicyType\",\n            person.first_name || ' ' || person.last_name as \"holder_name!\",\n            series,\n            number,\n            start_date,\n            end_date,\n            policy.status as \"status: PolicyStatus\",\n            car.make || ' ' || car.model as car_model,\n            car.plate as \"car_plate?\",\n            (\n                select string_agg(a.full_name, ', ' order by a.full_name)\n                from agent a\n                join agent_policy ap on a.id = ap.agent_id\n                where ap.policy_id = policy.id\n            ) as agent_names\n        from policy\n        join person on policy.holder_id = person.id\n        left join green_card_policy on policy.id = green_card_policy.id\n        left join osago_policy on policy.id = osago_policy.id\n        left join car on car.id = coalesce(green_card_policy.car_id, osago_policy.car_id)\n        where\n            ($1::text is null or lower(series || number) like $1)\n            and ($2::text is null or lower(person.first_name || ' ' || person.last_name) like $2)\n            and ($3::text is null or lower(coalesce(car.make || ' ' || car.model || ' ' || coalesce(car.plate, ''), '')) like $3)\n            and ($4::date is null or start_date >= $4)\n            and ($5::date is null or start_date <= $5)\n            and ($6::date is null or end_date >= $6)\n            and ($7::date is null or end_date <= $7)\n            and (cardinality($8::policy_type[]) = 0 or type = any($8::policy_type[]))\n            and (cardinality($9::policy_status[]) = 0 or policy.status = any($9::policy_status[]))\n        order by start_date desc\n        limit 150\n        ",
  "describe": {
    "columns": [
      {
        "ordinal": 0,
        "name": "id",
        "type_info": "Int4"
      },
      {
        "ordinal": 1,
        "name": "policy_type: PolicyType",
        "type_info": {
          "Custom": {
            "name": "policy_type",
            "kind": {
              "Enum": [
                "green_card",
                "medassistance",
                "osago"
              ]
            }
          }
        }
      },
      {
        "ordinal": 2,
        "name": "holder_name!",
        "type_info": "Text"
      },
      {
        "ordinal": 3,
        "name": "series",
        "type_info": "Varchar"
      },
      {
        "ordinal": 4,
        "name": "number",
        "type_info": "Varchar"
      },
      {
        "ordinal": 5,
        "name": "start_date",
        "type_info": "Date"
      },
      {
        "ordinal": 6,
        "name": "end_date",
        "type_info": "Date"
      },
      {
        "ordinal": 7,
        "name": "status: PolicyStatus",
        "type_info": {
          "Custom": {
            "name": "policy_status",
            "kind": {
              "Enum": [
                "active",
                "prolonged",
                "rejected",
                "stopped",
                "postponed",
                "cancelled",
                "project",
                "replaced",
                "expired"
              ]
            }
          }
        }
      },
      {
        "ordinal": 8,
        "name": "car_model",
        "type_info": "Text"
      },
      {
        "ordinal": 9,
        "name": "car_plate?",
        "type_info": "Varchar"
      },
      {
        "ordinal": 10,
        "name": "agent_names",
        "type_info": "Text"
      }
    ],
    "parameters": {
      "Left": [
        "Text",
        "Text",
        "Text",
        "Date",
        "Date",
        "Date",
        "Date",
        {
          "Custom": {
            "name": "policy_type[]",
            "kind": {
              "Array": {
                "Custom": {
                  "name": "policy_type",
                  "kind": {
                    "Enum": [
                      "green_card",
                      "medassistance",
                      "osago"
                    ]
                  }
                }
              }
            }
          }
        },
        {
          "Custom": {
            "name": "policy_status[]",
            "kind": {
              "Array": {
                "Custom": {
                  "name": "policy_status",
                  "kind": {
                    "Enum": [
                      "active",
                      "prolonged",
                      "rejected",
                      "stopped",
                      "postponed",
                      "cancelled",
                      "project",
                      "replaced",
                      "expired"
                    ]
                  }
                }
              }
            }
          }
        }
      ]
    },
    "nullable": [
      false,
      false,
      null,
      false,
      false,
      false,
      true,
      false,
      null,
      false,
      null
    ]
  },
  "hash": "32254b885399347f7485035b8c8a540b979e58edfcb24ddf694c44e2d8aaef33"
}
