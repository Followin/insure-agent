<div data-id="cards" class="grid grid-cols-3 gap-8">
  <p-card header="Люди">
    @if (stats()) {
      <span class="text-xl">{{ stats()!.people_count }}</span>
    } @else {
      <p-skeleton width="3rem" height="1.5rem" />
    }
  </p-card>
  <p-card header="Полисы">
    @if (stats()) {
      <span class="text-xl">{{ stats()!.policy_count }}</span>
    } @else {
      <p-skeleton width="3rem" height="1.5rem" />
    }
  </p-card>
  <p-card header="Машины">
    @if (stats()) {
      <span class="text-xl">{{ stats()!.car_count }}</span>
    } @else {
      <p-skeleton width="3rem" height="1.5rem" />
    }
  </p-card>
</div>
<div data-id="tables" class="grid grid-cols-2 gap-8 mt-8">
  <p-panel header="Дни рождения (ближайшие 7 дней)">
    <p-table [value]="stats()?.upcoming_birthdays ?? skeletonRows" size="large">
      <ng-template #header>
        <tr>
          <th>Имя</th>
          <th>Телефон</th>
          <th>Дата рождения</th>
          <th>Возраст</th>
          <th>Через дней</th>
        </tr>
      </ng-template>
      <ng-template #body let-person>
        @if (!loading) {
          <tr>
            <td class="whitespace-nowrap">
              <a [routerLink]="['/people', person.id]">
                {{ person.first_name }} {{ person.last_name }}
              </a>
            </td>
            <td>{{ person.phone }}</td>
            <td>{{ person.birth_date | date:'d MMM' }}</td>
            <td>{{ person.age }}</td>
            <td>
              @if (person.days_until === 0) {
                <p-tag severity="success" value="Сегодня!" />
              } @else {
                {{ person.days_until }}
              }
            </td>
          </tr>
        } @else {
          <tr>
            <td><p-skeleton /></td>
            <td><p-skeleton /></td>
            <td><p-skeleton /></td>
            <td><p-skeleton /></td>
            <td><p-skeleton /></td>
          </tr>
        }
      </ng-template>
      <ng-template #emptymessage>
        <tr>
          <td colspan="5" class="text-center text-gray-500 py-4">Нет дней рождения в ближайшие 7 дней</td>
        </tr>
      </ng-template>
    </p-table>
  </p-panel>
  <p-panel header="Полисы заканчиваются (ближайшие 7 дней)">
    <p-table [value]="stats()?.expiring_policies ?? skeletonRows" size="large">
      <ng-template #header>
        <tr>
          <th>Серия/Номер</th>
          <th>Страхователь</th>
          <th>Тип</th>
          <th>Дата окончания</th>
          <th>Через дней</th>
        </tr>
      </ng-template>
      <ng-template #body let-policy>
        @if (!loading) {
          <tr>
            <td>
              <a [routerLink]="['/policies', policy.id]">
                {{ policy.series }} {{ policy.number }}
              </a>
            </td>
            <td class="whitespace-nowrap">{{ policy.holder_first_name }} {{ policy.holder_last_name }}</td>
            <td>{{ policy.policy_type | policyTypeLocal }}</td>
            <td>{{ policy.end_date | date:'mediumDate' }}</td>
            <td>
              @if (policy.days_until === 0) {
                <p-tag severity="danger" value="Сегодня!" />
              } @else if (policy.days_until <= 2) {
                <p-tag severity="warn" [value]="policy.days_until.toString()" />
              } @else {
                {{ policy.days_until }}
              }
            </td>
          </tr>
        } @else {
          <tr>
            <td><p-skeleton /></td>
            <td><p-skeleton /></td>
            <td><p-skeleton /></td>
            <td><p-skeleton /></td>
            <td><p-skeleton /></td>
          </tr>
        }
      </ng-template>
      <ng-template #emptymessage>
        <tr>
          <td colspan="5" class="text-center text-gray-500 py-4">Нет полисов, заканчивающихся в ближайшие 7 дней</td>
        </tr>
      </ng-template>
    </p-table>
  </p-panel>
</div>
